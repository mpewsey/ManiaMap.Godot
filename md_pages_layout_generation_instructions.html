<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ManiaMap.Godot: Generating a Layout</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ManiaMap.png"/></td>
  <td id="projectalign">
   <div id="projectname">ManiaMap.Godot
   </div>
   <div id="projectbrief">Procedural generation of metroidvania style maps for Godot .NET.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_pages_layout_generation_instructions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Generating a Layout </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The following subsections outline how to procedurally generate an arrangement of rooms, called a <code>Layout</code>.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Step 1: Create Rooms and Room Templates</h1>
<p >The procedural generator creates layouts by pulling from user-defined room templates. To the generator, a room is a collection of cells in a grid, with information, such as the available door connections, assigned to them.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Creating a Room</h2>
<ol type="1">
<li>From an empty scene in Godot, create a <code>RoomNode2D</code> or <code>RoomNode3D</code> depending on whether you wish to develop in 2D or 3D. One of these node types must serve as the root of your room scene.</li>
<li>In the inspector, specify the number of cell rows and columns, along with the cell size to create the bounding shape of the room.</li>
<li>When the room node is selected, a toolbar will appear in the Godot main window (Circled in red in the screenshot below). The options on this toolbar may be used to edit the cell activities to further define the shape of the room. For instance, selecting the toggle edit mode button, then clicking or dragging over cells in the view will toggle the targeted cells on or off.</li>
</ol>
<blockquote class="doxtable">
<p >[!NOTE] For <code>RoomNode3D</code>, you must be in the top view in order to edit cell activities. The top view can be navigated to by clicking the positive Y axis on the axis gizmo or selecting <code>Top View</code> from the 3D main window's perspective menu. The toolbar will show a check mark when the cells can be edited. </p>
</blockquote>
<p>In the below screenshot, the cells for an angle shaped room have been created, with the active cells shown in blue and inactive cells shown in red and crossed-out. The active cells are the regions where we intend to build our scene.</p>
<p ><img src="https://github.com/mpewsey/ManiaMap.Godot/assets/23442063/15c94ef3-387c-43fa-8b46-a6bd2341dba4" alt="Screenshot 2024-05-31 141058" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Creating Doors</h2>
<p >Doors define the locations where two rooms can be connected. At least one door must be added to a room.</p>
<ol type="1">
<li>Add a <code>DoorNode2D</code> or <code>DoorNode3D</code> as a child of the room based on your room type. To save time, you may wish to create your doors as separate scenes with any related nodes, such as sprites or collision, as children. These scenes can then be referenced in your room scene.</li>
<li>Position the door within the room and assign its direction and connection constraints.</li>
<li>To auto assign the closest cell and direction to the door, make sure the applicable flags are selected in the inspector and click the <code>Auto Assign</code> button on the room toolbar. The assigned door direction will be based on its location relative to the center of its assigned cell.</li>
</ol>
<p >Additional room child nodes such as <code>CollectableSpot2D</code>, <code>Feature2D</code>, <code>RoomFlag2D</code>, or their respective 3D nodes can also be added to the room if you wish them to be included.</p>
<p ><img src="https://github.com/mpewsey/ManiaMap.Godot/assets/23442063/f7bff083-d1a2-452f-9d57-c79f68b1b31e" alt="Screenshot 2024-05-31 150604" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md8"></a>
Exporting Room Templates</h2>
<p >The procedural generator uses one or more <code>RoomTemplateResource</code> exported from <code>RoomNode2D</code> or <code>RoomNode3D</code> to generate layouts.</p>
<ul>
<li>To perform auto assignment and save the room template for an individual room, click the <code>Update Room Template</code> button on the room toolbar. This will create a <code>RoomTemplateResource</code> with the <code>.room_template.tres</code> extension at the same path as the scene.</li>
<li>Alternately, to perform this operation on multiple saved rooms within a project, select the <code>Project &gt; Tools &gt; Mania Map &gt; Batch Update Room Templates</code> option from the menu.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Step 2: Create Room Template Groups</h1>
<p >One or more <code>TemplateGroup</code> are used by the procedural generator to determine which rooms can be assigned to a given position in a layout.</p>
<ol type="1">
<li>To create a template group, right click in the Godot File System doc, select <code>Create New... &gt; Resource</code>, then create a new <code>TemplateGroup</code>.</li>
<li>Double click on the newly created template group and, in the Godot inspector, assign a unique name to the group.</li>
<li>For the <code>Entries</code> property, add a new <code>TemplateGroupEntry</code> element and assign a <code>RoomTemplateResource</code> to the <code>Room Template</code> property slot. Repeat this for all rooms that you wish to assign to the group.</li>
</ol>
<h1><a class="anchor" id="autotoc_md10"></a>
Step 3: Create a Layout Graph</h1>
<p >The procedural generator uses a <code>LayoutGraphResource</code> as a base for generating layouts. This allows you to design high level relationships between rooms while still making the resulting layout appear random.</p>
<ol type="1">
<li>To create a layout graph, right click in the Godot File System dock, select <code>Create New... &gt; Resource</code>, then create a new <code>LayoutGraphResource</code>.</li>
<li>Double click on created resource and a <code>Graph Editor</code> tab will appear in Godot's bottom panel.</li>
<li>In the <code>Graph Editor</code> panel, right click to add nodes, which will serve as room locations, to the graph.</li>
<li>To add edges, serving as connections between rooms, to the graph, click and drag between the circular handles on the right and left sides of two nodes.</li>
<li>Selecting nodes and/or edges will allow you to edit their properties in the Godot inspector. Each node must have a <code>TemplateGroup</code> assigned; though it is optional for edges.</li>
</ol>
<blockquote class="doxtable">
<p >[!NOTE] Edits to the layout graph will be saved automatically when Godot or the graph editor panel are closed. </p>
</blockquote>
<p><img src="https://github.com/mpewsey/ManiaMap.Godot/assets/23442063/5e2daf51-6ae6-47f7-8ccb-981780de94ec" alt="Screenshot 2024-05-31 193835" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md11"></a>
Step 4: Create a Generation Pipeline</h1>
<p >The <code>GenerationPipeline</code> takes various inputs and feeds them through a series of operational steps to generate one or more outputs. In the context of this plugin, the output is most notably a room <code>Layout</code>.</p>
<ol type="1">
<li>To create a pipeline, add a <code>GenerationPipeline</code> node to a new or existing scene.</li>
<li>Select the pipeline and click <code>Add Default Nodes</code> in the inspector. This will create a pipeline capable of generating a <code>Layout</code>.</li>
<li>Add one or more <code>LayoutGraphResource</code> to the automatically generated <code>LayoutGraphsInput</code> node.</li>
<li>Optionally, add one or more <code>CollectableGroup</code> to the automatically generated <code>CollectableGroupsInput</code> node.</li>
<li>Create a script that references the <code>GenerationPipeline</code> you wish to run, and call the <code>Run</code>, <code>RunAsync</code>, or <code>RunAttemptsAsync</code> methods to generate a layout. For example:</li>
</ol>
<div class="fragment"><div class="line">{ExampleGenerationPipelineRunner.cs} </div>
<div class="line">using MPewsey.ManiaMap;</div>
<div class="line">using MPewsey.ManiaMapGodot.Generators;</div>
<div class="line"> </div>
<div class="line">public partial class ExampleGenerationPipelineRunner : Node</div>
<div class="line">{</div>
<div class="line">    [Export] public GenerationPipeline Pipeline { get; set; }</div>
<div class="line"> </div>
<div class="line">    public void RunPipeline()</div>
<div class="line">    {</div>
<div class="line">        var results = Pipeline.Run();</div>
<div class="line">        var layout = results.GetOutput&lt;Layout&gt;(&quot;Layout&quot;);</div>
<div class="line"> </div>
<div class="line">        // At this point, you will probably want to do something with the layout...</div>
<div class="line">        //</div>
<div class="line">        // * You could save it to file using the JsonSerialization or XmlSerialization static classes.</div>
<div class="line">        // * You could use the ManiaMapManager and RoomTemplateGroupDatabase to instantiate the rooms in the layout.</div>
<div class="line">        // * You could use it with the LayoutTileMap or LayoutTileMapBook nodes to generate maps.</div>
<div class="line">        //</div>
<div class="line">        // See the project samples for example implementations.</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><blockquote class="doxtable">
<p >[!NOTE] Depending on your room templates and layout graph, it may not be possible to generate a layout for all (if any) random seeds. If you are encountering issues with successfully generating a layout, you may need to reconsider the constraints imposed on its generation. For example, you may need to add more doors to ensure that your rooms have a better chance of connecting. Even then, you may still encounter some isolated failures, in which case the generation pipeline <code>RunAttempsAsync</code> method can help by automatically falling back to other seeds. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
